import React, {useState, useEffect} from 'react'
import {getPosts, createPost} from '../api/apiClientWithToken'
import CreatePost from '../components/CreatePost'
import PostCard from '../components/PostCard'
import { Container} from 'react-bootstrap'

export default function Newsfeed() {
    const [posts, setPosts] = useState([])

    //get all posts from api
    const retrieveAllPosts = async () => {
        const response = await getPosts(localStorage.getItem('token'))
        return response
    };

    const createPost = async (data) => {
        console.log(data);
        const request = {
            ... data
        }

        const response = await createPost(localStorage.getItem('token'),data)
    }

    useEffect(() => {
        const getAllPosts = async () => {
            const posts = await retrieveAllPosts();
            if (posts) setPosts(posts);
        };
        getAllPosts();
    },[])


    return (
        <div className="newsfeed" style={{flex:'5.5'}}>
            <div className="wrapper" style={{padding:'20px'}}>
                <Container>
                <CreatePost/>
                {posts.map((i)=>(
                    <PostCard key={i.id} post={i} />
                ))}
                </Container>
            </div>  
        </div>
    )
}

{this.state.posts.map((post) => <PostCard key={post.id} post={post} /> )}



<div className="post">
            <div className="wrapper">
                <div className="top">
                    <img className="img" src="#"/>
                    <input type="text" placeholder="What's in your mind?" className="input" onChange={e => setPost(e.target.value)}/>
                </div>
                <hr className="hrPost"/>
                <div className="bottom">
                    <div className="options">
                    <button className="button">Post</button>
                    </div>
                </div>
            </div>
        </div>



mport React, { Component } from 'react'

export default class CreatePost extends Component {

    constructor() {
        super()
        this.state = {
            body: '',
            user_id: localStorage.getItem('user_id')
        }
    }

    handleTyping = (event) => {
        this.setState({username: event.target.value})
    }

    render() {
        return (
            <div>
                <div className="post">
                    <div className="wrapper">
                        <div className="top">
                            <img className="img" src="#"/>
                            <input type="text" placeholder="What's in your mind?" className="input" value={this.state.body} onChange={this.handleTyping}/>
                        </div>
                        <hr className="hrPost"/>
                        <div className="bottom">
                            <div className="options">
                            <button className="button">Post</button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        )
    }
}


import React, { Component } from 'react'

export default class CreatePost extends Component {

    constructor() {
        super()
        this.state = {
            body: '',
            user_id: localStorage.getItem('user_id')
        }
    }

    handleTyping = (event) => {
        this.setState({username: event.target.value})
    }

    render() {
        return (
            <div>
                <form>
                <div className="post">
                    <div className="wrapper">
                        <div className="top">
                            <img className="img" src="#"/>
                            <input type="text" placeholder="What's in your mind?" className="input" value={this.state.body} onChange={this.handleTyping}/>
                        </div>
                        <hr className="hrPost"/>
                    <div className="bottom">
                        <div className="options">
                            <button className="button">Post</button>
                        </div>
                    </div>
                </div>
                </div>
            </form>
            </div>
        )
    }
}


{errors.input && <small><div style={{color:'red'}}>{errors.input.message}</div></small>}


<img className="likeIcon" src="assets/heart.png" onClick={likeHandler} alt="" />
                        <span className="postLikeCounter">{like} people like it</span> 


<ProtectedRoute token={this.state.token}  exact path = "/createpost" render={()=><CreatePost user={this.state.user} user_id={this.state.user_id}/>}/>

 <Nav.Item>
                            <Nav.Link style={{color: 'gray'}} eventKey="link-1" as={Link} to="/createpost">Create Post</Nav.Link>
                        </Nav.Item>


import React, {useState, useEffect} from 'react'
import {getPosts} from '../api/apiClientWithToken'

import PostCard from '../components/PostCard'
import { Container} from 'react-bootstrap'

export default function Newsfeed() {
    const [posts, setPosts] = useState([])

    //get all posts from api
    const retrieveAllPosts = async () => {
        const response = await getPosts(localStorage.getItem('token'))
        return response
    };

    useEffect(() => {
        const getAllPosts = async () => {
            const posts = await retrieveAllPosts();
            if (posts) setPosts(posts);
        };
        getAllPosts();
    },[])


    return (
        <div className="newsfeed mt-5" style={{flex:'5.5'}}>
            <div className="wrapper" style={{padding:'20px'}}>
                <Container>                 
              
                {posts.map((i)=>(
                    <PostCard key={i.id} post={i} />
                ))}
                </Container>
            </div>  
        </div>
    )
}


import React, { Component } from 'react'
import {getMyPosts} from '../api/apiClientWithToken'
import {Redirect} from 'react-router-dom'

import PostCard from '../components/PostCard'
import { Container, Alert} from 'react-bootstrap'

export default class MyPosts extends Component {

    constructor(){
        super();
        this.state = {
            posts: [],
            serverError:false,
            tokenError:false,
        }
    }

    componentDidMount(){this.getAllMyPosts}

    getAllMyPosts = async () => {
        console.log("calling api")
        const posts = await getMyPosts(localStorage.getItem('token'))
        if(posts === 400){this.setState({tokenError:true})}
        if(posts === 500){this.setState({serverError:true})}
        if (posts !== 500 && cats !== 400){
            this.setState({posts:posts})
    }}

    render() {
        return (
            <div>
                {this.state.serverError?<Alert variant="danger">Error Try Again Later</Alert>:''}
                {this.state.tokenError?<Redirect to='/login'/>:''}

                <div className="myposts mt-5" style={{flex:'5.5'}}>
                <div className="wrapper" style={{padding:'20px'}}>
                    <Container>                 
                
                    {this.state.posts.map((i)=>(
                        <PostCard key={i.id} post={i} />
                    ))}
                    </Container>
                </div>  
            </div>
        )
    }
}

